---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Ahorcado">
  <h1>Ahorcado</h1>
  <div class="hangman-container">
    <div class="word-display" id="word-display"></div>
    <div class="guesses-left" id="guesses-left">Intentos restantes: 6</div>
    <div class="guessed-letters" id="guessed-letters">Letras usadas:</div>
    <div class="keyboard" id="keyboard"></div>
    <button id="restart-hangman">Reiniciar Juego</button>
  </div>
</Layout>

<style>
  .hangman-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
    margin-top: 50px;
  }

  .word-display {
    font-size: 2.5em;
    letter-spacing: 5px;
    margin-bottom: 20px;
  }

  .guesses-left, .guessed-letters {
    font-size: 1.2em;
  }

  .keyboard {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(40px, 1fr));
    gap: 5px;
    width: 80%;
    max-width: 600px;
    margin-top: 20px;
  }

  .key {
    background-color: var(--card-back-color);
    border: 1px solid var(--key-border-color);
    padding: 10px;
    font-size: 1.2em;
    cursor: pointer;
    text-align: center;
    border-radius: 5px;
    transition: background-color 0.2s;
  }

  .key:hover:not(.disabled) {
    background-color: #eee;
  }

  .key.disabled {
    background-color: var(--key-disabled-background);
    cursor: not-allowed;
    opacity: 0.6;
  }

  #restart-hangman {
    margin-top: 30px;
    padding: 10px 20px;
    font-size: 1em;
    cursor: pointer;
  }
</style>

<script is:inline>
  const words = ["PROGRAMACION", "COMPUTADORA", "DESARROLLO", "JAVASCRIPT", "ASTRO", "FRONTEND", "BACKEND"];
  let selectedWord = '';
  let guessedWord = [];
  let wrongGuesses = 0;
  let guessedLetters = [];
  const maxWrongGuesses = 6;

  const wordDisplay = document.getElementById('word-display');
  const guessesLeftDisplay = document.getElementById('guesses-left');
  const guessedLettersDisplay = document.getElementById('guessed-letters');
  const keyboard = document.getElementById('keyboard');
  const restartButton = document.getElementById('restart-hangman');

  function initializeGame() {
    selectedWord = words[Math.floor(Math.random() * words.length)];
    guessedWord = Array(selectedWord.length).fill('_');
    wrongGuesses = 0;
    guessedLetters = [];
    renderGame();
    createKeyboard();
  }

  function renderGame() {
    wordDisplay.textContent = guessedWord.join(' ');
    guessesLeftDisplay.textContent = `Intentos restantes: ${maxWrongGuesses - wrongGuesses}`;
    guessedLettersDisplay.textContent = `Letras usadas: ${guessedLetters.join(', ')}`;

    if (wrongGuesses >= maxWrongGuesses) {
      guessesLeftDisplay.textContent = `¡Has perdido! La palabra era: ${selectedWord}`;
      disableKeyboard();
    } else if (!guessedWord.includes('_')) {
      guessesLeftDisplay.textContent = `¡Felicidades! Has ganado.`;
      disableKeyboard();
    }
  }

  function createKeyboard() {
    keyboard.innerHTML = '';
    for (let i = 65; i <= 90; i++) { // ASCII for A-Z
      const letter = String.fromCharCode(i);
      const keyElement = document.createElement('div');
      keyElement.classList.add('key');
      keyElement.textContent = letter;
      keyElement.dataset.letter = letter;
      keyElement.addEventListener('click', handleGuess);
      keyboard.appendChild(keyElement);
    }
  }

  function handleGuess(event) {
    const guessedLetter = event.target.dataset.letter;
    if (guessedLetters.includes(guessedLetter) || wrongGuesses >= maxWrongGuesses || !guessedWord.includes('_')) {
      return;
    }

    guessedLetters.push(guessedLetter);
    event.target.classList.add('disabled');

    if (selectedWord.includes(guessedLetter)) {
      for (let i = 0; i < selectedWord.length; i++) {
        if (selectedWord[i] === guessedLetter) {
          guessedWord[i] = guessedLetter;
        }
      }
    } else {
      wrongGuesses++;
    }
    renderGame();
  }

  function disableKeyboard() {
    document.querySelectorAll('.key').forEach(key => {
      key.classList.add('disabled');
      key.removeEventListener('click', handleGuess);
    });
  }

  restartButton.addEventListener('click', initializeGame);

  initializeGame();
</script>